<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
        
    <form action="" method="post" id="loveForm">
        {% csrf_token %}

        {{ form.name1 }}
        {{ form.name2 }}
        
        <button type="submit" id="submit"> Ã‰ros, dis-nous tout ğŸ¹ğŸ’˜âœ¨ </button>
    </form>

    <div id="result" style="display: none;"></div>




    <script>

        function interpreteScore(score){
            if (score > 90){
                return 'ğŸ’˜ Ã‚mes sÅ“urs ! Une connexion rare.'
            } else if (score > 75){
                return "ğŸ’– TrÃ¨s bonne compatibilitÃ©, beaucoup dâ€™amour en vue !"
            } else if(score > 50){
                return "ğŸ’ Bon match, Ã§a peut fonctionner avec un peu dâ€™effort."
            }   else if(score > 30) {
                return "ğŸ’” Des hauts et des bas, mais tout est possible."
            }   else if(score > 10){
                return "âš ï¸ TrÃ¨s peu compatiblesâ€¦ mais qui sait ?"
            } else{
                return "âŒ Mieux vaut rester amis."
            }

        }
        // quand le js envoie le formulaire la vue envoie une rÃ©ponse json que le js rÃ©cupere avec fetch etconvertit en objet js 
        loveForm = document.getElementById('loveForm')
        btnSubmit = document.getElementById('submit')
        
        btnSubmit.addEventListener('click', function(){
            event.preventDefault() // POur que la page ne se recharge pas quand le formulaire est soumis 
            let formData = new FormData(loveForm)
            fetch('', {
                method : 'post',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': loveForm.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body : formData // un objet javascript qui contient tous les donnÃ©s du formulaire
            })

            .then(response => response.json()) // Convertit la rÃ©ponse qui est au format json en objet js
            
            .then(data => {
            if (data.percentage !== undefined){
                resultat = document.getElementById('result') 
                resultat.style.display = 'block'
                resultat.textContent = "Votre amour brille Ã  " + data.percentage + "%" + interpreteScore(data.percentage)
                
            }

        })
        })
      
    </script>
</body>
</html>